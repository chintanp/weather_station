<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Weather Station - Datalogger to Browser </title>

		<meta name="description" content="A description of the weather station project">
		<meta name="author" content="Chintan Pathak">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/sky.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<style type="text/css">
			.loadingImg {
			    padding: 0 20px;
			    margin: 0 20px;
			    background-color: white;
			    vertical-align: middle;
			}

			.error {
			    color: red;
			    font-weight: bold;
			    vertical-align: middle;
			}


		</style>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h2>Automatic Weather Station</h2>
					<h4>Real time commmunication .... </h4>
					<h4>... from datalogger to browser </h4>
					<img src="images\qrcode.jpeg">
					<p>
						<small>View it live at <a href="http://www.ipsacademy.org/weather" target="_blank">IPSA Weather Station</a></small>
					</p>
				</section>

				<section>
					<h2>Heads Up</h2>
					<p>
						Some really multi-disciplinary engineering jargons coming your way. 
					</p>

				</section>

				
				<section>
					<h2> Weather </h2>
					<p class="fragment"> ... is all around us </p>
					<p class="fragment"> ... some of it, we can measure </p>
					<h2 class="fragment"> Station </h2>
					<p class="fragment"> ... this one does'nt move.</p>
				</section>

				<section>
					<h2> What can we measure </h2>
					<ol class="fragment">
						<li >Atmospheric Pressure</li>
						<li>Temperature</li>
						<li>Humidity</li>
						<li>Solar Radiation</li>
						<li>Rainfall</li>
						<li>Wind Speed</li>
						<li>Wind Direction</li>
					</ol>
					<p class="fragment">... so far </p>

				</section>

				<section>
					<h1>How ? </h1>
					<img class="fragment" src="images\weather-stone.jpg">
				</section>

				<section>
					<p> Or </p>
					<img class="fragment" src="images\weather-station.jpg">
					<p>Click<a href="https://drive.google.com/folderview?id=0B9fbkDTtTJfSdTFrbk9DUlc2TlU&usp=sharing" target="_blank"> here</a> for details about sensors and connections</p>
				</section>

				<section>
					<h1>And </h1>
					<img class="fragment" src="images\DT80M.jpg">
					<p> DT80M Datalogger - <a href="https://drive.google.com/folderview?id=0B9fbkDTtTJfSamJQaV9jd2Nud28&usp=sharing" target="_blank">details</a> </p>
				</section>

				<section>
					<h2>What are those ports on the side</h2>
					<ul>
						<li class="fragment">Ethernet Port</li>
						<li class="fragment">USB Port</li>
					</ul>
				</section>

				<section>
					<h1>Server</h1>
					<ul>
						<li class="fragment">Query the data from the logger</li>
						<li class="fragment">Format and parse the data</li>
						<li class="fragment">Store it into local database</li>
						<li class="fragment">Store it into cloud database</li>
						<li class="fragment">Upload data to World weather aggregators</li>
						<li class="fragment">Send to the browser</li>
					</ul>
				</section>

				<section>
					<h2> Data Flow </h2>
					<img src="images/data_flow.jpg">
				</section>

				<section >
					<h2 ><strong>Software Stack</strong></h2>
					<h3 align="left" class="fragment">NodeJS + MongoDB </h3>
					<h3 align="right" class="fragment">AngularJS + Socket.IO</h3>
					
				</section>

				<section>
					<h3>Query the data from the logger</h3>
					<pre style="background:#404040;color:#dedede"><span style="color:#709070;font-style:italic">//Create a TCP socket to read data from datalogger</span>
<span style="color:#6080ff">var</span> tcp_socket <span style="color:#ffffa0">=</span> net.createConnection(TCP_PORT, TCP_HOST);
tcp_socket.on(<span style="color:#ff2020">'connect'</span>, <span style="color:#6080ff">function</span>(connect) {
   
   <span style="color:#709070;font-style:italic">// Send this string to set the output format for the Datalogger</span>
   tcp_socket.write(<span style="color:#ff2020">"/h/E/M/R"</span>);
   <span style="color:#f09040">console</span>.log(<span style="color:#ff2020">'connection established with TCP host: '</span> <span style="color:#ffffa0">+</span> TCP_HOST);
   tcp_socket.setEncoding(<span style="color:#ff2020">'ascii'</span>);
});
</pre>
				</section>

				<section>
					<h3>Store data in local mongo database</h3>
					<pre style="background:#404040;color:#dedede"><span style="color:#709070;font-style:italic">//Connect to the database - using the module mongojs - which exposes mongodb like API</span>
<span style="color:#6080ff">var</span> db <span style="color:#ffffa0">=</span> require(<span style="color:#ff2020">"mongojs"</span>).connect(databaseUrl, collections); 

<span style="color:#709070;font-style:italic">//Insert data - now formatted to dbString - into the collection raw_data</span>
db.raw_data.insert(dbString, <span style="color:#6080ff">function</span>(err, saved) {
    <span style="color:#ffffa0">if</span>( err <span style="color:#ffffa0">||</span> <span style="color:#ffffa0">!</span>saved ) <span style="color:#f09040">console</span>.log(<span style="color:#ff2020">"Data not saved"</span>);
    <span style="color:#ffffa0">else</span> <span style="color:#f09040">console</span>.log(<span style="color:#ff2020">"Data saved"</span>);
});
</pre>
					
				</section>

				<section>
					<h3>Store data in <strong>cloud</strong> mongo database</h3>
					<pre style="background:#404040;color:#dedede"><span style="color:#709070;font-style:italic">// Save the cloud db on MongoLab</span>
  mongodb.MongoClient.connect(uri, <span style="color:#6080ff">function</span> (err, cloud_db) {
    cloud_db.collection(<span style="color:#ff2020">'raw_data'</span>, <span style="color:#6080ff">function</span>(err, collection) {
        <span style="color:#ffffa0">if</span>(<span style="color:#ffffa0">!</span>err) {
            collection.insert(dbString, <span style="color:#6080ff">function</span>(docs) {
                collection.count(<span style="color:#6080ff">function</span>(err, count) {
                    <span style="color:#ffffa0">if</span>(<span style="color:#ffffa0">!</span>err) {
                        <span style="color:#f09040">console</span>.log(<span style="color:#ff2020">"Saved to mongolab"</span>);
                    }
                });
            });
         }
     });
  });
</pre>
					
				</section>

				<section>
					<h4>Upload data to World weather aggregator</h4>
					<p>To OpenWeatherMap.org</p>
					<pre style="background:#404040;color:#dedede"><span style="color:#709070;font-style:italic">// Upload data to openweathermap.org</span>
  request.post(url_owm, {form:{<span style="color:#ff2020">'temp'</span>:dbString.temp_c, 
                              <span style="color:#ff2020">'wind_dir'</span>: dbString.wind_dir,
                              <span style="color:#ff2020">'wind_speed'</span>: dbString.wind_speed_mps,
                              <span style="color:#ff2020">'humidity'</span>: dbString.humidity,
                              <span style="color:#ff2020">'pressure'</span>: dbString.pressure_mbar,
                              <span style="color:#ff2020">'lat'</span>: dbString.lat,
                              <span style="color:#ff2020">'long'</span>: dbString.<span style="color:#6080ff">long</span>,
                              <span style="color:#ff2020">'lum'</span>: dbString.solar_rad_wpsqm,
                              <span style="color:#ff2020">'name'</span>: <span style="color:#ff2020">"AWSIES1"</span>
                              }}, <span style="color:#6080ff">function</span> <span style="color:#fc6;font-weight:700">optionalCallback</span> (err, httpResponse, body) {
    <span style="color:#ffffa0">if</span> (err) {
      <span style="color:#ffffa0">return</span> <span style="color:#f09040">console</span>.error(<span style="color:#ff2020">'upload failed:'</span>, err);
    }
    <span style="color:#f09040">console</span>.log(<span style="color:#ff2020">'Upload successful on OWM!  Server responded with:'</span>, body);
  });
</pre>
					
				</section>

				<section>
					<h3> Socket.IO </h3>
					<p class="fragment" data-fragment-index="0">On the server

					<pre class="fragment" data-fragment-index="0" style="background:#404040;color:#dedede"><span style="color:#709070;font-style:italic">// Hook Socket.io into Express</span>
<span style="color:#6080ff">var</span> io <span style="color:#ffffa0">=</span> require(<span style="color:#ff2020">'socket.io'</span>).listen(server);
tcp_socket.on(<span style="color:#ff2020">'data'</span>, <span style="color:#6080ff">function</span>(data) {
        
<span style="color:#709070;font-style:italic">// This event is emitted, observe the matching event in the frontend controller.</span>
<span style="color:#709070;font-style:italic">// It receives this sent livedata and updates the view accordingly.</span>
io.sockets.emit(<span style="color:#ff2020">'livedata'</span>, { livedata: data });
</pre></p>
					
					<p class="fragment" data-fragment-index="1">On the client

						<pre class="fragment" data-fragment-index="1" style="background:#404040;color:#dedede"><span style="color:#709070;font-style:italic">&lt;!--</span> Include the socket.io <span style="color:#ffffa0">-</span> <span style="color:#ffffa0">in</span> html scope now <span style="color:#709070;font-style:italic">--></span>
<span style="color:#ffffa0">&lt;</span>script type<span style="color:#ffffa0">=</span><span style="color:#ff2020">"text/javascript"</span> src<span style="color:#ffffa0">=</span><span style="color:#ff2020">"/socket.io/socket.io.js"</span><span style="color:#ffffa0">></span><span style="color:#ffffa0">&lt;</span>/script<span style="color:#ffffa0">></span>

<span style="color:#6080ff">var</span> socket <span style="color:#ffffa0">=</span> io.connect(<span style="color:#ff2020">"103.9.12.125:8000"</span>);

socket.on(<span style="color:#ff2020">'livedata'</span>, <span style="color:#6080ff">function</span>(data) {

    <span style="color:#709070;font-style:italic">//Do something with the data</span>
</pre></p>
				
				</section>

				<section >
					<img src="images\angularjs.jpg">
					<h3> AngularJS on the Frontend </h3>
					<pre style="background:#404040;color:#dedede">&lt;tbody ng-repeat=<span style="color:#ff2020">"weather_row in weatherdata"</span>>
&lt;tr>
   &lt;td>{{ $index + 1 }}&lt;/td>
   &lt;td>{{ weather_row.sensor }}&lt;/td>
   &lt;td>{{ weather_row.value + <span style="color:#ff2020">" "</span> + weather_row.unit }}&lt;/td>
&lt;/tr>
&lt;/tbody>
</pre>
				</section>

				<section>
					<h2>What has been done</h2>
					<p class="fragment"> ... of the weather</p>
					<ul>
						<li class="fragment">Some of it is <strong>measured</strong></li>
						<li class="fragment">Some of it is <strong>captured</strong></li>
						<li class="fragment">Most of it is <strong>stored</strong></li>
						<li class="fragment">and <strong>transmitted</strong> to the server which</li>
						<ul>
							<li class="fragment">Saves it to a local DB</li>
							<li class="fragment">Saves it to a cloud DB</li>
							<li class="fragment">Uploads it to world weather aggregators</li>
							<li class="fragment">Relays it to the browser</li>	
						</ul>
					</ul>
					<p class="fragment"><strong>all in real-time ... automatically</strong></p>
					<h4 class="fragment"><a href="http://www.ipsacademy.org/weather" target="_blank">Automatic Weather Station 1.0 @ IPSA</a></h4>
				</section>

				<section>
					<h2>What next</h2>
					<ul>
						<li class="fragment">Low-cost</li>
						<li class="fragment">Mobile/Portable</li>
						<li class="fragment">Wireless</li>
						<li class="fragment">Thin</li>
					</ul>
				</section>


			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
